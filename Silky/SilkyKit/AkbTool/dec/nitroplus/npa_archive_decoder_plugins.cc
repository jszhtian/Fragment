// Copyright (C) 2016 by rr-
//
// This file is part of arc_unpacker.
//
// arc_unpacker is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or (at
// your option) any later version.
//
// arc_unpacker is distributed in the hope that it will be useful, but
// WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
// General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with arc_unpacker. If not, see <http://www.gnu.org/licenses/>.

#include "dec/nitroplus/npa_archive_decoder.h"
#include "algo/range.h"

using namespace au;
using namespace au::dec::nitroplus;

static std::shared_ptr<NpaPlugin> create_chaos_head_filter()
{
    return std::make_shared<NpaPlugin>(
        "\xF1\x71\x80\x19\x17\x01\x74\x7D\x90\x47\xF9\x68\xDE\xB4\x24\x40"
        "\x73\x9E\x5B\x38\x4C\x3A\x2A\x0D\x2E\xB9\x5C\xE9\xCE\xE8\x3E\x39"
        "\xA2\xF8\xA8\x5E\x1D\x1B\xD3\x23\xCB\x9B\xB0\xD5\x59\xF0\x3B\x09"
        "\x4D\xE4\x4A\x30\x7F\x89\x44\xA0\x7A\x3C\xEE\x0E\x66\xBF\xC9\x46"
        "\x77\x21\x86\x78\x6E\x8E\xE6\x99\x33\x2B\x0C\xEA\x42\x85\xD2\x8F"
        "\x5F\x94\xDA\xAC\x76\xB7\x51\xBA\x0B\xD4\x91\x28\x72\xAE\xE7\xD6"
        "\xBD\x53\xA3\x4F\x9D\xC5\xCC\x5D\x18\x96\x02\xA5\xC2\x63\xF4\x00"
        "\x6B\xEB\x79\x95\x83\xA7\x8C\x9A\xAB\x8A\x4E\xD7\xDB\xCA\x62\x27"
        "\x0A\xD1\xDD\x48\xC6\x88\xB6\xA9\x41\x10\xFE\x55\xE0\xD9\x06\x29"
        "\x65\x6A\xED\xE5\x98\x52\xFF\x8D\x43\xF6\xA4\xCF\xA6\xF2\x97\x13"
        "\x12\x04\xFD\x25\x81\x87\xEF\x2F\x6C\x84\x2C\xAA\xA1\xAF\x36\xCD"
        "\x92\x0F\x2D\x67\x45\xE2\x64\xB3\x20\x50\x4B\xF3\x7B\x1F\x1C\x03"
        "\xC4\xC1\x16\x61\x6F\xC7\xBE\x05\xAD\x22\x34\xB2\x54\x37\xF7\xD0"
        "\xFA\x60\x8B\x14\x08\xBC\xEC\xBB\x26\x9C\x57\x32\x5A\x3F\x35\x6D"
        "\xC8\xC3\x69\x7C\x31\x58\xE3\x75\xD8\xE1\xC0\x9F\x11\xB5\x93\x56"
        "\xF5\x1E\xB1\x1A\x70\x3D\xFB\x82\xDC\xDF\x7E\x07\x15\x49\xFC\xB8"_b,
        0x87654321,
        [](const u32 key1, const u32 key2) { return key1 * key2; });
}

static std::shared_ptr<NpaPlugin> create_muramasa_filter()
{
    return std::make_shared<NpaPlugin>(
        "\x48\xE8\xD3\x11\x1D\x58\xEA\xE5\x23\xBD\x41\xC0\x86\x6A\x0A\xB3"
        "\xE9\x26\xAE\x90\xBF\x92\x02\x55\x06\x61\xAF\xF1\x76\xF0\x96\x91"
        "\x34\x40\x30\xA6\x15\x1E\x89\x09\x7E\x2E\x63\x8B\xA1\x43\x9E\x51"
        "\xB5\xFA\xB2\x93\xE7\xD1\xBA\x33\xE2\x9F\xF6\x56\xCC\x67\x71\xBC"
        "\xED\x08\xDC\xE0\xC6\xD6\xFC\x21\x99\x0E\x5F\xF2\xB4\xDB\x84\xD7"
        "\xA7\x2A\x82\x3F\xEC\x6D\xA8\x62\x5E\x8A\x28\x00\xE4\x36\xFD\x8C"
        "\x65\xA9\x39\xB7\x25\x7B\x7F\xA5\x10\x2C\x54\x3B\x74\xC9\x4A\x53"
        "\xCE\xFE\xE1\x2B\xD9\x3D\xDF\x22\x3E\xD2\xB6\x8D\x8E\x72\xC4\x0D"
        "\x52\x88\x85\xB0\x7C\xD0\x6C\x31\xB8\x13\x46\xAB\xF3\x81\x5C\x01"
        "\xCB\xC2\xF5\xFB\x20\xA4\x47\xD5\xB9\x4C\x3A\x77\x3C\x44\x2D\x19"
        "\x14\x5A\x45\x0B\xD8\xDD\xF7\x07\xCF\xDA\x0F\x32\x38\x37\x9C\x75"
        "\x24\x57\x05\xCD\xBB\xF4\xCA\x69\x03\xA3\xBE\x49\xEE\x17\x1F\x59"
        "\x7A\x78\x1C\xC8\xC7\x7D\x66\x5B\x35\x04\x9A\x64\xAA\x9D\x4D\x83"
        "\x42\xC3\xDE\x1A\x50\x6F\xFF\x6E\x0C\x2F\xAD\x94\xA2\x97\x9B\xC5"
        "\x70\x79\xC1\xEF\x98\xA0\xF9\xEB\x80\xF8\x73\x27\x18\x6B\x29\xAC"
        "\x4B\x16\x68\x12\xE3\x95\x4E\xD4\x8F\x87\xE6\x5D\x1B\xB1\x4F\x60"_b,
        0x87654321,
        [](const u32 key1, const u32 key2) { return key1 * key2; });
}

NpaArchiveDecoder::NpaArchiveDecoder()
{
    plugin_manager.add(
        "chaos-head",
        "ChaoS;HEAd",
        create_chaos_head_filter());

    plugin_manager.add(
        "muramasa",
        "Full Metal Daemon Muramasa",
        create_muramasa_filter());

    add_arg_parser_decorator(
        plugin_manager.create_arg_parser_decorator(
            "Selects NPA decryption routine."));
}
